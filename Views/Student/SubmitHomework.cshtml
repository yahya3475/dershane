@using dershane.Models
@model SubmitHomeworkVM

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg">
                <div class="card-header bg-warning text-dark">
                    <h3 class="mb-0">üìù Submit Assignment</h3>
                </div>
                <div class="card-body">
                    @* Debug information *@
                    <div class="alert alert-secondary">
                        <strong>Debug:</strong><br>
                        Model is null: @(Model == null)<br>
                        ViewData Model: @(ViewData["DebugModel"] != null)<br>
                        ViewBag Homework: @(ViewBag.DebugHomework != null)<br>
                        @if (Model != null)
                        {
                            <text>
                            HomeworkId: @Model.HomeworkId<br>
                            Title: @(Model.Title ?? "NULL")<br>
                            DueDate: @Model.DueDate.ToString("yyyy-MM-dd HH:mm:ss")<br>
                            DueDate Ticks: @Model.DueDate.Ticks<br>
                            DueDate == MinValue: @(Model.DueDate == DateTime.MinValue)<br>
                            Now: @DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")<br>
                            Is Expired: @(Model.DueDate < DateTime.Now)
                            </text>
                        }
                        @if (ViewBag.DebugHomework != null)
                        {
                            var hw = ViewBag.DebugHomework as dershane.Models.Homework;
                            <text>
                            <br><strong>ViewBag Homework:</strong><br>
                            ID: @hw.Id<br>
                            Title: @hw.Title<br>
                            DueDate: @hw.DueDate.ToString("yyyy-MM-dd HH:mm:ss")
                            </text>
                        }
                    </div>

                    @* Rest of the code remains the same *@
                    <div class="alert alert-info">
                        <h5><i class="bi bi-info-circle me-2"></i>@(Model?.Title ?? "No Title")</h5>
                        <p><strong>Subject:</strong> @(Model?.Lesson ?? "No Subject")</p>
                        <p><strong>Due Date:</strong> @(Model?.DueDate.ToString("dd.MM.yyyy HH:mm") ?? "No Date")</p>
                        <hr>
                        <p><strong>Description:</strong></p>
                        <p>@(Model?.Description ?? "No Description")</p>
                    </div>

                    @if (Model == null)
                    {
                        <div class="alert alert-danger">Model is NULL!</div>
                    }
                    else if (Model.DueDate == DateTime.MinValue)
                    {
                        <div class="alert alert-warning">DueDate is MinValue!</div>
                    }
                    else if (Model.DueDate < DateTime.Now)
                    {
                        <div class="alert alert-danger">Assignment deadline has passed!</div>
                    }
                    else
                    {
                        <form asp-action="SubmitHomework" method="post">
                            @Html.AntiForgeryToken()
                            <input type="hidden" asp-for="HomeworkId" />

                            <div class="mb-4">
                                <label asp-for="Answer" class="form-label fw-bold">Your Answer</label>
                                <textarea asp-for="Answer" class="form-control" rows="10"></textarea>
                                <span asp-validation-for="Answer" class="text-danger"></span>
                            </div>

                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-success btn-lg">
                                    <i class="bi bi-check-lg me-2"></i>Submit Assignment
                                </button>
                            </div>
                        </form>
                    }

                    <div class="mt-3">
                        <a asp-action="ViewHomeworks" class="btn btn-secondary">
                            <i class="bi bi-arrow-left me-2"></i>Go Back
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>